/*
 * ATTENTION: An "eval-source-map" devtool has been used.
 * This devtool is neither made for production nor for readable output files.
 * It uses "eval()" calls to create a separate source file with attached SourceMaps in the browser devtools.
 * If you are trying to read the output file, select a different devtool (https://webpack.js.org/configuration/devtool/)
 * or disable the default devtool with "devtool: false".
 * If you are looking for production-ready output files, see mode: "production" (https://webpack.js.org/configuration/mode/).
 */
(() => {
var exports = {};
exports.id = "app/api/optimize-resume/route";
exports.ids = ["app/api/optimize-resume/route"];
exports.modules = {

/***/ "(rsc)/./node_modules/next/dist/build/webpack/loaders/next-app-loader/index.js?name=app%2Fapi%2Foptimize-resume%2Froute&page=%2Fapi%2Foptimize-resume%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Foptimize-resume%2Froute.ts&appDir=%2FUsers%2Fcolinhayes%2Frezia-ai-resume-craft%2Fsrc%2Fapp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=%2FUsers%2Fcolinhayes%2Frezia-ai-resume-craft&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D!":
/*!*******************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************!*\
  !*** ./node_modules/next/dist/build/webpack/loaders/next-app-loader/index.js?name=app%2Fapi%2Foptimize-resume%2Froute&page=%2Fapi%2Foptimize-resume%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Foptimize-resume%2Froute.ts&appDir=%2FUsers%2Fcolinhayes%2Frezia-ai-resume-craft%2Fsrc%2Fapp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=%2FUsers%2Fcolinhayes%2Frezia-ai-resume-craft&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D! ***!
  \*******************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   patchFetch: () => (/* binding */ patchFetch),\n/* harmony export */   routeModule: () => (/* binding */ routeModule),\n/* harmony export */   serverHooks: () => (/* binding */ serverHooks),\n/* harmony export */   workAsyncStorage: () => (/* binding */ workAsyncStorage),\n/* harmony export */   workUnitAsyncStorage: () => (/* binding */ workUnitAsyncStorage)\n/* harmony export */ });\n/* harmony import */ var next_dist_server_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next/dist/server/route-modules/app-route/module.compiled */ \"(rsc)/./node_modules/next/dist/server/route-modules/app-route/module.compiled.js\");\n/* harmony import */ var next_dist_server_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(next_dist_server_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var next_dist_server_route_kind__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! next/dist/server/route-kind */ \"(rsc)/./node_modules/next/dist/server/route-kind.js\");\n/* harmony import */ var next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! next/dist/server/lib/patch-fetch */ \"(rsc)/./node_modules/next/dist/server/lib/patch-fetch.js\");\n/* harmony import */ var next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2___default = /*#__PURE__*/__webpack_require__.n(next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2__);\n/* harmony import */ var _Users_colinhayes_rezia_ai_resume_craft_src_app_api_optimize_resume_route_ts__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./src/app/api/optimize-resume/route.ts */ \"(rsc)/./src/app/api/optimize-resume/route.ts\");\n\n\n\n\n// We inject the nextConfigOutput here so that we can use them in the route\n// module.\nconst nextConfigOutput = \"\"\nconst routeModule = new next_dist_server_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0__.AppRouteRouteModule({\n    definition: {\n        kind: next_dist_server_route_kind__WEBPACK_IMPORTED_MODULE_1__.RouteKind.APP_ROUTE,\n        page: \"/api/optimize-resume/route\",\n        pathname: \"/api/optimize-resume\",\n        filename: \"route\",\n        bundlePath: \"app/api/optimize-resume/route\"\n    },\n    resolvedPagePath: \"/Users/colinhayes/rezia-ai-resume-craft/src/app/api/optimize-resume/route.ts\",\n    nextConfigOutput,\n    userland: _Users_colinhayes_rezia_ai_resume_craft_src_app_api_optimize_resume_route_ts__WEBPACK_IMPORTED_MODULE_3__\n});\n// Pull out the exports that we need to expose from the module. This should\n// be eliminated when we've moved the other routes to the new format. These\n// are used to hook into the route.\nconst { workAsyncStorage, workUnitAsyncStorage, serverHooks } = routeModule;\nfunction patchFetch() {\n    return (0,next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2__.patchFetch)({\n        workAsyncStorage,\n        workUnitAsyncStorage\n    });\n}\n\n\n//# sourceMappingURL=app-route.js.map//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9ub2RlX21vZHVsZXMvbmV4dC9kaXN0L2J1aWxkL3dlYnBhY2svbG9hZGVycy9uZXh0LWFwcC1sb2FkZXIvaW5kZXguanM/bmFtZT1hcHAlMkZhcGklMkZvcHRpbWl6ZS1yZXN1bWUlMkZyb3V0ZSZwYWdlPSUyRmFwaSUyRm9wdGltaXplLXJlc3VtZSUyRnJvdXRlJmFwcFBhdGhzPSZwYWdlUGF0aD1wcml2YXRlLW5leHQtYXBwLWRpciUyRmFwaSUyRm9wdGltaXplLXJlc3VtZSUyRnJvdXRlLnRzJmFwcERpcj0lMkZVc2VycyUyRmNvbGluaGF5ZXMlMkZyZXppYS1haS1yZXN1bWUtY3JhZnQlMkZzcmMlMkZhcHAmcGFnZUV4dGVuc2lvbnM9dHN4JnBhZ2VFeHRlbnNpb25zPXRzJnBhZ2VFeHRlbnNpb25zPWpzeCZwYWdlRXh0ZW5zaW9ucz1qcyZyb290RGlyPSUyRlVzZXJzJTJGY29saW5oYXllcyUyRnJlemlhLWFpLXJlc3VtZS1jcmFmdCZpc0Rldj10cnVlJnRzY29uZmlnUGF0aD10c2NvbmZpZy5qc29uJmJhc2VQYXRoPSZhc3NldFByZWZpeD0mbmV4dENvbmZpZ091dHB1dD0mcHJlZmVycmVkUmVnaW9uPSZtaWRkbGV3YXJlQ29uZmlnPWUzMCUzRCEiLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7QUFBK0Y7QUFDdkM7QUFDcUI7QUFDNEI7QUFDekc7QUFDQTtBQUNBO0FBQ0Esd0JBQXdCLHlHQUFtQjtBQUMzQztBQUNBLGNBQWMsa0VBQVM7QUFDdkI7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBLFlBQVk7QUFDWixDQUFDO0FBQ0Q7QUFDQTtBQUNBO0FBQ0EsUUFBUSxzREFBc0Q7QUFDOUQ7QUFDQSxXQUFXLDRFQUFXO0FBQ3RCO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDMEY7O0FBRTFGIiwic291cmNlcyI6WyIiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgQXBwUm91dGVSb3V0ZU1vZHVsZSB9IGZyb20gXCJuZXh0L2Rpc3Qvc2VydmVyL3JvdXRlLW1vZHVsZXMvYXBwLXJvdXRlL21vZHVsZS5jb21waWxlZFwiO1xuaW1wb3J0IHsgUm91dGVLaW5kIH0gZnJvbSBcIm5leHQvZGlzdC9zZXJ2ZXIvcm91dGUta2luZFwiO1xuaW1wb3J0IHsgcGF0Y2hGZXRjaCBhcyBfcGF0Y2hGZXRjaCB9IGZyb20gXCJuZXh0L2Rpc3Qvc2VydmVyL2xpYi9wYXRjaC1mZXRjaFwiO1xuaW1wb3J0ICogYXMgdXNlcmxhbmQgZnJvbSBcIi9Vc2Vycy9jb2xpbmhheWVzL3JlemlhLWFpLXJlc3VtZS1jcmFmdC9zcmMvYXBwL2FwaS9vcHRpbWl6ZS1yZXN1bWUvcm91dGUudHNcIjtcbi8vIFdlIGluamVjdCB0aGUgbmV4dENvbmZpZ091dHB1dCBoZXJlIHNvIHRoYXQgd2UgY2FuIHVzZSB0aGVtIGluIHRoZSByb3V0ZVxuLy8gbW9kdWxlLlxuY29uc3QgbmV4dENvbmZpZ091dHB1dCA9IFwiXCJcbmNvbnN0IHJvdXRlTW9kdWxlID0gbmV3IEFwcFJvdXRlUm91dGVNb2R1bGUoe1xuICAgIGRlZmluaXRpb246IHtcbiAgICAgICAga2luZDogUm91dGVLaW5kLkFQUF9ST1VURSxcbiAgICAgICAgcGFnZTogXCIvYXBpL29wdGltaXplLXJlc3VtZS9yb3V0ZVwiLFxuICAgICAgICBwYXRobmFtZTogXCIvYXBpL29wdGltaXplLXJlc3VtZVwiLFxuICAgICAgICBmaWxlbmFtZTogXCJyb3V0ZVwiLFxuICAgICAgICBidW5kbGVQYXRoOiBcImFwcC9hcGkvb3B0aW1pemUtcmVzdW1lL3JvdXRlXCJcbiAgICB9LFxuICAgIHJlc29sdmVkUGFnZVBhdGg6IFwiL1VzZXJzL2NvbGluaGF5ZXMvcmV6aWEtYWktcmVzdW1lLWNyYWZ0L3NyYy9hcHAvYXBpL29wdGltaXplLXJlc3VtZS9yb3V0ZS50c1wiLFxuICAgIG5leHRDb25maWdPdXRwdXQsXG4gICAgdXNlcmxhbmRcbn0pO1xuLy8gUHVsbCBvdXQgdGhlIGV4cG9ydHMgdGhhdCB3ZSBuZWVkIHRvIGV4cG9zZSBmcm9tIHRoZSBtb2R1bGUuIFRoaXMgc2hvdWxkXG4vLyBiZSBlbGltaW5hdGVkIHdoZW4gd2UndmUgbW92ZWQgdGhlIG90aGVyIHJvdXRlcyB0byB0aGUgbmV3IGZvcm1hdC4gVGhlc2Vcbi8vIGFyZSB1c2VkIHRvIGhvb2sgaW50byB0aGUgcm91dGUuXG5jb25zdCB7IHdvcmtBc3luY1N0b3JhZ2UsIHdvcmtVbml0QXN5bmNTdG9yYWdlLCBzZXJ2ZXJIb29rcyB9ID0gcm91dGVNb2R1bGU7XG5mdW5jdGlvbiBwYXRjaEZldGNoKCkge1xuICAgIHJldHVybiBfcGF0Y2hGZXRjaCh7XG4gICAgICAgIHdvcmtBc3luY1N0b3JhZ2UsXG4gICAgICAgIHdvcmtVbml0QXN5bmNTdG9yYWdlXG4gICAgfSk7XG59XG5leHBvcnQgeyByb3V0ZU1vZHVsZSwgd29ya0FzeW5jU3RvcmFnZSwgd29ya1VuaXRBc3luY1N0b3JhZ2UsIHNlcnZlckhvb2tzLCBwYXRjaEZldGNoLCAgfTtcblxuLy8jIHNvdXJjZU1hcHBpbmdVUkw9YXBwLXJvdXRlLmpzLm1hcCJdLCJuYW1lcyI6W10sImlnbm9yZUxpc3QiOltdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(rsc)/./node_modules/next/dist/build/webpack/loaders/next-app-loader/index.js?name=app%2Fapi%2Foptimize-resume%2Froute&page=%2Fapi%2Foptimize-resume%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Foptimize-resume%2Froute.ts&appDir=%2FUsers%2Fcolinhayes%2Frezia-ai-resume-craft%2Fsrc%2Fapp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=%2FUsers%2Fcolinhayes%2Frezia-ai-resume-craft&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D!\n");

/***/ }),

/***/ "(rsc)/./node_modules/next/dist/build/webpack/loaders/next-flight-client-entry-loader.js?server=true!":
/*!******************************************************************************************************!*\
  !*** ./node_modules/next/dist/build/webpack/loaders/next-flight-client-entry-loader.js?server=true! ***!
  \******************************************************************************************************/
/***/ (() => {



/***/ }),

/***/ "(rsc)/./src/app/api/optimize-resume/route.ts":
/*!**********************************************!*\
  !*** ./src/app/api/optimize-resume/route.ts ***!
  \**********************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   POST: () => (/* binding */ POST),\n/* harmony export */   runtime: () => (/* binding */ runtime)\n/* harmony export */ });\n/* harmony import */ var next_server__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next/server */ \"(rsc)/./node_modules/next/dist/api/server.js\");\n/* harmony import */ var _clerk_nextjs_server__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! @clerk/nextjs/server */ \"(rsc)/./node_modules/@clerk/nextjs/dist/esm/app-router/server/auth.js\");\n/* harmony import */ var _clerk_nextjs_server__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! @clerk/nextjs/server */ \"(rsc)/./node_modules/@clerk/nextjs/dist/esm/server/clerkClient.js\");\n/* harmony import */ var _lib_prisma__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @/lib/prisma */ \"(rsc)/./src/lib/prisma.ts\");\n/* harmony import */ var crypto__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! crypto */ \"crypto\");\n/* harmony import */ var crypto__WEBPACK_IMPORTED_MODULE_2___default = /*#__PURE__*/__webpack_require__.n(crypto__WEBPACK_IMPORTED_MODULE_2__);\n\n\n\n\n\n// heavy parsing steps moved to Pages API for faster warm lambdas\n// Removed direct import of internal API handlers; using HTTP fetch to Pages API instead\nconst runtime = 'nodejs';\n/**\n * API Route: Full orchestration of resume optimization as a single Node.js function\n */ async function POST(req) {\n    try {\n        const { resumeText, jobDescription, templateId, fileName } = await req.json();\n        if (!resumeText || !jobDescription) {\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                error: 'Missing resumeText or jobDescription'\n            }, {\n                status: 400\n            });\n        }\n        // Authenticate user\n        const session = await (0,_clerk_nextjs_server__WEBPACK_IMPORTED_MODULE_3__.auth)();\n        const userId = session.userId;\n        if (!userId) {\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                error: 'Unauthorized'\n            }, {\n                status: 401\n            });\n        }\n        // Ensure user record\n        const clerkUser = await (await (0,_clerk_nextjs_server__WEBPACK_IMPORTED_MODULE_4__.clerkClient)()).users.getUser(userId);\n        const email = clerkUser.emailAddresses[0]?.emailAddress || '';\n        const fullName = `${clerkUser.firstName || ''} ${clerkUser.lastName || ''}`.trim();\n        await _lib_prisma__WEBPACK_IMPORTED_MODULE_1__.prisma.user.upsert({\n            where: {\n                id: userId\n            },\n            create: {\n                id: userId,\n                email,\n                fullName\n            },\n            update: {\n                email,\n                fullName\n            }\n        });\n        // Save resume file metadata\n        const originalTextHash = (0,crypto__WEBPACK_IMPORTED_MODULE_2__.createHash)('sha256').update(resumeText).digest('hex');\n        const resumeFile = await _lib_prisma__WEBPACK_IMPORTED_MODULE_1__.prisma.resumeFile.create({\n            data: {\n                userId,\n                fileName: fileName || '',\n                filePath: '',\n                originalTextHash\n            }\n        });\n        // Construct base URL for Pages API fetches\n        const protocol =  true ? 'http' : 0;\n        const host = req.headers.get('host');\n        const baseUrl = `${protocol}://${host}`;\n        // 1. Extract JD info via Pages API\n        const jdRes = await fetch(`${baseUrl}/api/extract-jd-info`, {\n            method: 'POST',\n            headers: {\n                'Content-Type': 'application/json'\n            },\n            body: JSON.stringify({\n                jobDescription\n            })\n        });\n        if (!jdRes.ok) throw new Error('extract-jd-info failed');\n        const { keywords, targetTitle, targetCompany, requirements } = await jdRes.json();\n        // 2. Parse resume via Pages API (with caching)\n        const parseRes = await fetch(`${baseUrl}/api/parse-resume`, {\n            method: 'POST',\n            headers: {\n                'Content-Type': 'application/json'\n            },\n            body: JSON.stringify({\n                resume: resumeText,\n                jobDescription\n            })\n        });\n        if (!parseRes.ok) throw new Error('parse-resume failed');\n        const { parsedResume } = await parseRes.json();\n        // Deep-clone to preserve the original parsed resume before mutation\n        const originalParsedResume = JSON.parse(JSON.stringify(parsedResume));\n        // Work on a separate copy for updates\n        let updated = JSON.parse(JSON.stringify(parsedResume));\n        // 3. Map keywords via Pages API\n        const mapRes = await fetch(`${baseUrl}/api/map-keywords`, {\n            method: 'POST',\n            headers: {\n                'Content-Type': 'application/json'\n            },\n            body: JSON.stringify({\n                resumeData: updated,\n                keywords\n            })\n        });\n        if (!mapRes.ok) throw new Error('map-keywords failed');\n        const { assignments } = await mapRes.json();\n        // 4. Rewrite bullets in parallel with limited concurrency, avoiding duplicate start verbs\n        const rewriteResults = [];\n        // Track used leading verbs to avoid repetition\n        const usedVerbs = [];\n        // Prepare tasks for each bullet\n        const tasks = [];\n        updated.work.forEach((workItem, wi)=>{\n            workItem.bullets.forEach((bullet, bi)=>{\n                const assignment = assignments.find((a)=>a.workIndex === wi && a.bulletIndex === bi);\n                tasks.push({\n                    wi,\n                    bi,\n                    bullet,\n                    assignedKeywords: assignment?.assignedKeywords || []\n                });\n            });\n        });\n        const concurrency = 3;\n        for(let i = 0; i < tasks.length; i += concurrency){\n            const batch = tasks.slice(i, i + concurrency);\n            // Send rewrite requests, passing already used verbs\n            const results = await Promise.all(batch.map(async ({ wi, bi, bullet, assignedKeywords })=>{\n                const bulletRes = await fetch(`${baseUrl}/api/rewrite-bullet`, {\n                    method: 'POST',\n                    headers: {\n                        'Content-Type': 'application/json'\n                    },\n                    body: JSON.stringify({\n                        bullet,\n                        keywords: assignedKeywords,\n                        jobTitle: updated.work[wi].title,\n                        company: updated.work[wi].company,\n                        jobDescription,\n                        skills: updated.skills,\n                        targetTitle,\n                        targetCompany,\n                        requirements,\n                        usedVerbs\n                    })\n                });\n                if (!bulletRes.ok) throw new Error('rewrite-bullet failed');\n                const { rewrittenBullet, keywordsUsed } = await bulletRes.json();\n                return {\n                    wi,\n                    bi,\n                    rewrittenBullet,\n                    keywordsUsed\n                };\n            }));\n            // Apply results and capture leading verbs\n            results.forEach(({ wi, bi, rewrittenBullet, keywordsUsed })=>{\n                updated.work[wi].bullets[bi] = rewrittenBullet;\n                rewriteResults.push({\n                    workIndex: wi,\n                    bulletIndex: bi,\n                    rewrittenBullet,\n                    keywordsUsed\n                });\n                // Extract first word as verb and track it\n                const firstWord = rewrittenBullet.trim().split(/\\s+/)[0].replace(/[^A-Za-z]/g, '');\n                if (firstWord) usedVerbs.push(firstWord.toLowerCase());\n            });\n        }\n        // 5. Rewrite summary\n        // 5. Rewrite summary via Pages API\n        // Build an experience snapshot for prompt context\n        const companies = Array.from(new Set(parsedResume.work.map((w)=>w.company))).join(', ');\n        const titles = Array.from(new Set(parsedResume.work.map((w)=>w.title))).join(', ');\n        const parseYear = (s)=>{\n            const m = s.match(/\\d{4}/);\n            return m ? parseInt(m[0], 10) : null;\n        };\n        const endYears = parsedResume.work.map((w)=>parseYear(w.to || '') || new Date().getFullYear()).filter((y)=>!!y);\n        const startYears = parsedResume.work.map((w)=>parseYear(w.from || '') || endYears[0] || new Date().getFullYear()).filter((y)=>!!y);\n        const yearsExp = endYears.length && startYears.length ? Math.max(...endYears) - Math.min(...startYears) : null;\n        const experienceSnapshot = [\n            yearsExp ? `${yearsExp}+ years of experience` : '',\n            companies ? `across ${companies}` : '',\n            titles ? `roles as ${titles}` : ''\n        ].filter(Boolean).join(', ') + '.';\n        const summaryRes = await fetch(`${baseUrl}/api/rewrite-summary`, {\n            method: 'POST',\n            headers: {\n                'Content-Type': 'application/json'\n            },\n            body: JSON.stringify({\n                originalSummary: parsedResume.summary,\n                optimizedBullets: updated.work.flatMap((w)=>w.bullets),\n                skills: updated.skills,\n                targetTitle,\n                targetCompany,\n                requirements,\n                keywords,\n                jobDescription,\n                experienceSnapshot\n            })\n        });\n        if (!summaryRes.ok) throw new Error('rewrite-summary failed');\n        const { rewrittenSummary } = await summaryRes.json();\n        updated.summary = rewrittenSummary;\n        // 6. Rewrite skills\n        // 6. Rewrite skills via Pages API\n        const skillsRes = await fetch(`${baseUrl}/api/rewrite-skills`, {\n            method: 'POST',\n            headers: {\n                'Content-Type': 'application/json'\n            },\n            body: JSON.stringify({\n                originalSkills: updated.skills,\n                optimizedSummary: updated.summary,\n                optimizedBullets: updated.work.flatMap((w)=>w.bullets),\n                keywords,\n                targetTitle,\n                targetCompany,\n                requirements,\n                jobDescription\n            })\n        });\n        if (!skillsRes.ok) throw new Error('rewrite-skills failed');\n        const { rewrittenSkills } = await skillsRes.json();\n        updated.skills = rewrittenSkills;\n        // 7. Rewrite projects via Pages API (if present)\n        if (parsedResume.projects && parsedResume.projects.length > 0) {\n            const projRes = await fetch(`${baseUrl}/api/rewrite-projects`, {\n                method: 'POST',\n                headers: {\n                    'Content-Type': 'application/json'\n                },\n                body: JSON.stringify({\n                    projects: parsedResume.projects,\n                    keywords,\n                    requirements,\n                    targetTitle,\n                    targetCompany,\n                    jobDescription,\n                    skills: updated.skills,\n                    summary: updated.summary\n                })\n            });\n            if (!projRes.ok) throw new Error('rewrite-projects failed');\n            const { rewrittenProjects } = await projRes.json();\n            updated.projects = rewrittenProjects;\n        }\n        // 8. Persist optimization run\n        const runData = {\n            userId,\n            resumeFileId: resumeFile.id,\n            jobDescription,\n            templateId: String(templateId),\n            originalText: JSON.stringify(originalParsedResume),\n            optimizedText: JSON.stringify(updated),\n            bulletRewrites: rewriteResults,\n            summaryRewrite: updated.summary,\n            skillsRewrite: JSON.stringify(updated.skills),\n            keywords,\n            requirements,\n            targetTitle,\n            targetCompany,\n            aiModel: 'o3-mini-2025-01-31',\n            tokenCount: 0,\n            costUsd: 0\n        };\n        const run = await _lib_prisma__WEBPACK_IMPORTED_MODULE_1__.prisma.optimizationRun.create({\n            data: runData\n        });\n        // Return full result\n        return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n            runId: run.id,\n            originalResume: originalParsedResume,\n            optimizedResume: updated,\n            keywords,\n            requirements,\n            targetTitle,\n            targetCompany\n        });\n    } catch (error) {\n        console.error('Error in optimize-resume:', error);\n        return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n            error: error.message || 'Internal error'\n        }, {\n            status: 500\n        });\n    }\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9zcmMvYXBwL2FwaS9vcHRpbWl6ZS1yZXN1bWUvcm91dGUudHMiLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7QUFBMkM7QUFDQztBQUNPO0FBQ2I7QUFDRjtBQUdwQyxpRUFBaUU7QUFDakUsd0ZBQXdGO0FBRWpGLE1BQU1LLFVBQVUsU0FBUztBQVNoQzs7Q0FFQyxHQUNNLGVBQWVDLEtBQUtDLEdBQVk7SUFDckMsSUFBSTtRQUNGLE1BQU0sRUFBRUMsVUFBVSxFQUFFQyxjQUFjLEVBQUVDLFVBQVUsRUFBRUMsUUFBUSxFQUFFLEdBQUksTUFBTUosSUFBSUssSUFBSTtRQUM1RSxJQUFJLENBQUNKLGNBQWMsQ0FBQ0MsZ0JBQWdCO1lBQ2xDLE9BQU9ULHFEQUFZQSxDQUFDWSxJQUFJLENBQUM7Z0JBQUVDLE9BQU87WUFBdUMsR0FBRztnQkFBRUMsUUFBUTtZQUFJO1FBQzVGO1FBRUEsb0JBQW9CO1FBQ3BCLE1BQU1DLFVBQVUsTUFBTWQsMERBQUlBO1FBQzFCLE1BQU1lLFNBQVNELFFBQVFDLE1BQU07UUFDN0IsSUFBSSxDQUFDQSxRQUFRO1lBQ1gsT0FBT2hCLHFEQUFZQSxDQUFDWSxJQUFJLENBQUM7Z0JBQUVDLE9BQU87WUFBZSxHQUFHO2dCQUFFQyxRQUFRO1lBQUk7UUFDcEU7UUFFQSxxQkFBcUI7UUFDckIsTUFBTUcsWUFBWSxNQUFNLENBQUMsTUFBTWYsaUVBQVdBLEVBQUMsRUFBR2dCLEtBQUssQ0FBQ0MsT0FBTyxDQUFDSDtRQUM1RCxNQUFNSSxRQUFRSCxVQUFVSSxjQUFjLENBQUMsRUFBRSxFQUFFQyxnQkFBZ0I7UUFDM0QsTUFBTUMsV0FBVyxHQUFHTixVQUFVTyxTQUFTLElBQUksR0FBRyxDQUFDLEVBQUVQLFVBQVVRLFFBQVEsSUFBSSxJQUFJLENBQUNDLElBQUk7UUFDaEYsTUFBTXZCLCtDQUFNQSxDQUFDd0IsSUFBSSxDQUFDQyxNQUFNLENBQUM7WUFDdkJDLE9BQU87Z0JBQUVDLElBQUlkO1lBQU87WUFDcEJlLFFBQVE7Z0JBQUVE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S0MsU0FBUyxDQUFDWTtZQUM5Qm9GLGdCQUFnQmhGO1lBQ2hCaUYsZ0JBQWdCckYsUUFBUW9FLE9BQU87WUFDL0JrQixlQUFlbkcsS0FBS0MsU0FBUyxDQUFDWSxRQUFRa0MsTUFBTTtZQUM1QzNDO1lBQ0FHO1lBQ0FGO1lBQ0FDO1lBQ0E4RixTQUFTO1lBQ1RDLFlBQVk7WUFDWkMsU0FBUztRQUNYO1FBQ0EsTUFBTUMsTUFBTSxNQUFNcEosK0NBQU1BLENBQUNxSixlQUFlLENBQUN6SCxNQUFNLENBQUM7WUFBRUssTUFBTXdHO1FBQWU7UUFFdkUscUJBQXFCO1FBQ3JCLE9BQU81SSxxREFBWUEsQ0FBQ1ksSUFBSSxDQUFDO1lBQ3ZCNkksT0FBT0YsSUFBSXpILEVBQUU7WUFDYjRILGdCQUFnQi9GO1lBQ2hCZ0csaUJBQWlCOUY7WUFDakJUO1lBQ0FHO1lBQ0FGO1lBQ0FDO1FBQ0Y7SUFDRixFQUFFLE9BQU96QyxPQUFZO1FBQ25CK0ksUUFBUS9JLEtBQUssQ0FBQyw2QkFBNkJBO1FBQzNDLE9BQU9iLHFEQUFZQSxDQUFDWSxJQUFJLENBQUM7WUFBRUMsT0FBT0EsTUFBTWdKLE9BQU8sSUFBSTtRQUFpQixHQUFHO1lBQUUvSSxRQUFRO1FBQUk7SUFDdkY7QUFDRiIsInNvdXJjZXMiOlsiL1VzZXJzL2NvbGluaGF5ZXMvcmV6aWEtYWktcmVzdW1lLWNyYWZ0L3NyYy9hcHAvYXBpL29wdGltaXplLXJlc3VtZS9yb3V0ZS50cyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBOZXh0UmVzcG9uc2UgfSBmcm9tICduZXh0L3NlcnZlcic7XG5pbXBvcnQgeyBhdXRoIH0gZnJvbSAnQGNsZXJrL25leHRqcy9zZXJ2ZXInO1xuaW1wb3J0IHsgY2xlcmtDbGllbnQgfSBmcm9tICdAY2xlcmsvbmV4dGpzL3NlcnZlcic7XG5pbXBvcnQgeyBwcmlzbWEgfSBmcm9tICdAL2xpYi9wcmlzbWEnO1xuaW1wb3J0IHsgY3JlYXRlSGFzaCB9IGZyb20gJ2NyeXB0byc7XG5cbmltcG9ydCB0eXBlIHsgUmVzdW1lRGF0YSwgRXh0cmFjdEpESW5mb1Jlc3BvbnNlLCBQYXJzZVJlc3VtZVJlc3BvbnNlLCBNYXBLZXl3b3Jkc1Jlc3BvbnNlLCBSZXdyaXRlQnVsbGV0UmVzcG9uc2UsIFJld3JpdGVTdW1tYXJ5UmVzcG9uc2UsIFJld3JpdGVTa2lsbHNSZXNwb25zZSwgT3B0aW1pemF0aW9uUnVuRGF0YSwgQnVsbGV0UmV3cml0ZVJlc3VsdCB9IGZyb20gJ0AvdHlwZXMvcmVzdW1lJztcbi8vIGhlYXZ5IHBhcnNpbmcgc3RlcHMgbW92ZWQgdG8gUGFnZXMgQVBJIGZvciBmYXN0ZXIgd2FybSBsYW1iZGFzXG4vLyBSZW1vdmVkIGRpcmVjdCBpbXBvcnQgb2YgaW50ZXJuYWwgQVBJIGhhbmRsZXJzOyB1c2luZyBIVFRQIGZldGNoIHRvIFBhZ2VzIEFQSSBpbnN0ZWFkXG5cbmV4cG9ydCBjb25zdCBydW50aW1lID0gJ25vZGVqcyc7XG5cbmludGVyZmFjZSBPcHRpbWl6ZVJlc3VtZVJlcXVlc3Qge1xuICByZXN1bWVUZXh0OiBzdHJpbmc7XG4gIGpvYkRlc2NyaXB0aW9uOiBzdHJpbmc7XG4gIHRlbXBsYXRlSWQ/OiBzdHJpbmc7XG4gIGZpbGVOYW1lPzogc3RyaW5nO1xufVxuXG4vKipcbiAqIEFQSSBSb3V0ZTogRnVsbCBvcmNoZXN0cmF0aW9uIG9mIHJlc3VtZSBvcHRpbWl6YXRpb24gYXMgYSBzaW5nbGUgTm9kZS5qcyBmdW5jdGlvblxuICovXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gUE9TVChyZXE6IFJlcXVlc3QpIHtcbiAgdHJ5IHtcbiAgICBjb25zdCB7IHJlc3VtZVRleHQsIGpvYkRlc2NyaXB0aW9uLCB0ZW1wbGF0ZUlkLCBmaWxlTmFtZSB9ID0gKGF3YWl0IHJlcS5qc29uKCkpIGFzIE9wdGltaXplUmVzdW1lUmVxdWVzdDtcbiAgICBpZiAoIXJlc3VtZVRleHQgfHwgIWpvYkRlc2NyaXB0aW9uKSB7XG4gICAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oeyBlcnJvcjogJ01pc3NpbmcgcmVzdW1lVGV4dCBvciBqb2JEZXNjcmlwdGlvbicgfSwgeyBzdGF0dXM6IDQwMCB9KTtcbiAgICB9XG5cbiAgICAvLyBBdXRoZW50aWNhdGUgdXNlclxuICAgIGNvbnN0IHNlc3Npb24gPSBhd2FpdCBhdXRoKCk7XG4gICAgY29uc3QgdXNlcklkID0gc2Vzc2lvbi51c2VySWQ7XG4gICAgaWYgKCF1c2VySWQpIHtcbiAgICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbih7IGVycm9yOiAnVW5hdXRob3JpemVkJyB9LCB7IHN0YXR1czogNDAxIH0pO1xuICAgIH1cblxuICAgIC8vIEVuc3VyZSB1c2VyIHJlY29yZFxuICAgIGNvbnN0IGNsZXJrVXNlciA9IGF3YWl0IChhd2FpdCBjbGVya0NsaWVudCgpKS51c2Vycy5nZXRVc2VyKHVzZXJJZCk7XG4gICAgY29uc3QgZW1haWwgPSBjbGVya1VzZXIuZW1haWxBZGRyZXNzZXNbMF0/LmVtYWlsQWRkcmVzcyB8fCAnJztcbiAgICBjb25zdCBmdWxsTmFtZSA9IGAke2NsZXJrVXNlci5maXJzdE5hbWUgfHwgJyd9ICR7Y2xlcmtVc2VyLmxhc3ROYW1lIHx8ICcnfWAudHJpbSgpO1xuICAgIGF3YWl0IHByaXNtYS51c2VyLnVwc2VydCh7XG4gICAgICB3aGVyZTogeyBpZDogdXNlcklkIH0sXG4gICAgICBjcmVhdGU6IHsgaWQ6IHVzZXJJZCwgZW1haWwsIGZ1bGxOYW1lIH0sXG4gICAgICB1cGRhdGU6IHsgZW1haWwsIGZ1bGxOYW1lIH0sXG4gICAgfSk7XG5cbiAgICAvLyBTYXZlIHJlc3VtZSBmaWxlIG1ldGFkYXRhXG4gICAgY29uc3Qgb3JpZ2luYWxUZXh0SGFzaCA9IGNyZWF0ZUhhc2goJ3NoYTI1NicpLnVwZGF0ZShyZXN1bWVUZXh0KS5kaWdlc3QoJ2hleCcpO1xuICAgIGNvbnN0IHJlc3VtZUZpbGUgPSBhd2FpdCBwcmlzbWEucmVzdW1lRmlsZS5jcmVhdGUoe1xuICAgICAgZGF0YTogeyB1c2VySWQsIGZpbGVOYW1lOiBmaWxlTmFtZSB8fCAnJywgZmlsZVBhdGg6ICcnLCBvcmlnaW5hbFRleHRIYXNoIH0sXG4gICAgfSk7XG5cbiAgICAvLyBDb25zdHJ1Y3QgYmFzZSBVUkwgZm9yIFBhZ2VzIEFQSSBmZXRjaGVzXG4gICAgY29uc3QgcHJvdG9jb2wgPSBwcm9jZXNzLmVudi5OT0RFX0VOViA9PT0gJ2RldmVsb3BtZW50JyA/ICdodHRwJyA6ICdodHRwcyc7XG4gICAgY29uc3QgaG9zdCA9IHJlcS5oZWFkZXJzLmdldCgnaG9zdCcpO1xuICAgIGNvbnN0IGJhc2VVcmwgPSBgJHtwcm90b2NvbH06Ly8ke2hvc3R9YDtcbiAgICAvLyAxLiBFeHRyYWN0IEpEIGluZm8gdmlhIFBhZ2VzIEFQSVxuICAgIGNvbnN0IGpkUmVzID0gYXdhaXQgZmV0Y2goYCR7YmFzZVVybH0vYXBpL2V4dHJhY3QtamQtaW5mb2AsIHtcbiAgICAgIG1ldGhvZDogJ1BPU1QnLFxuICAgICAgaGVhZGVyczogeyAnQ29udGVudC1UeXBlJzogJ2FwcGxpY2F0aW9uL2pzb24nIH0sXG4gICAgICBib2R5OiBKU09OLnN0cmluZ2lmeSh7IGpvYkRlc2NyaXB0aW9uIH0pLFxuICAgIH0pO1xuICAgIGlmICghamRSZXMub2spIHRocm93IG5ldyBFcnJvcignZXh0cmFjdC1qZC1pbmZvIGZhaWxlZCcpO1xuICAgIGNvbnN0IHsga2V5d29yZHMsIHRhcmdldFRpdGxlLCB0YXJnZXRDb21wYW55LCByZXF1aXJlbWVudHMgfSA9IChhd2FpdCBqZFJlcy5qc29uKCkpIGFzIEV4dHJhY3RKREluZm9SZXNwb25zZTtcblxuICAgIC8vIDIuIFBhcnNlIHJlc3VtZSB2aWEgUGFnZXMgQVBJICh3aXRoIGNhY2hpbmcpXG4gICAgY29uc3QgcGFyc2VSZXMgPSBhd2FpdCBmZXRjaChgJHtiYXNlVXJsfS9hcGkvcGFyc2UtcmVzdW1lYCwge1xuICAgICAgbWV0aG9kOiAnUE9TVCcsXG4gICAgICBoZWFkZXJzOiB7ICdDb250ZW50LVR5cGUnOiAnYXBwbGljYXRpb24vanNvbicgfSxcbiAgICAgIGJvZHk6IEpTT04uc3RyaW5naWZ5KHsgcmVzdW1lOiByZXN1bWVUZXh0LCBqb2JEZXNjcmlwdGlvbiB9KSxcbiAgICB9KTtcbiAgICBpZiAoIXBhcnNlUmVzLm9rKSB0aHJvdyBuZXcgRXJyb3IoJ3BhcnNlLXJlc3VtZSBmYWlsZWQnKTtcbiAgICBjb25zdCB7IHBhcnNlZFJlc3VtZSB9ID0gKGF3YWl0IHBhcnNlUmVzLmpzb24oKSkgYXMgUGFyc2VSZXN1bWVSZXNwb25zZTtcbiAgICAvLyBEZWVwLWNsb25lIHRvIHByZXNlcnZlIHRoZSBvcmlnaW5hbCBwYXJzZWQgcmVzdW1lIGJlZm9yZSBtdXRhdGlvblxuICAgIGNvbnN0IG9yaWdpbmFsUGFyc2VkUmVzdW1lOiBSZXN1bWVEYXRhID0gSlNPTi5wYXJzZShKU09OLnN0cmluZ2lmeShwYXJzZWRSZXN1bWUpKTtcbiAgICAvLyBXb3JrIG9uIGEgc2VwYXJhdGUgY29weSBmb3IgdXBkYXRlc1xuICAgIGxldCB1cGRhdGVkOiBSZXN1bWVEYXRhID0gSlNPTi5wYXJzZShKU09OLnN0cmluZ2lmeShwYXJzZWRSZXN1bWUpKTtcblxuICAgIC8vIDMuIE1hcCBrZXl3b3JkcyB2aWEgUGFnZXMgQVBJXG4gICAgY29uc3QgbWFwUmVzID0gYXdhaXQgZmV0Y2goYCR7YmFzZVVybH0vYXBpL21hcC1rZXl3b3Jkc2AsIHtcbiAgICAgIG1ldGhvZDogJ1BPU1QnLFxuICAgICAgaGVhZGVyczogeyAnQ29udGVudC1UeXBlJzogJ2FwcGxpY2F0aW9uL2pzb24nIH0sXG4gICAgICBib2R5OiBKU09OLnN0cmluZ2lmeSh7IHJlc3VtZURhdGE6IHVwZGF0ZWQsIGtleXdvcmRzIH0pLFxuICAgIH0pO1xuICAgIGlmICghbWFwUmVzLm9rKSB0aHJvdyBuZXcgRXJyb3IoJ21hcC1rZXl3b3JkcyBmYWlsZWQnKTtcbiAgICBjb25zdCB7IGFzc2lnbm1lbnRzIH0gPSAoYXdhaXQgbWFwUmVzLmpzb24oKSkgYXMgTWFwS2V5d29yZHNSZXNwb25zZTtcblxuICAgIC8vIDQuIFJld3JpdGUgYnVsbGV0cyBpbiBwYXJhbGxlbCB3aXRoIGxpbWl0ZWQgY29uY3VycmVuY3ksIGF2b2lkaW5nIGR1cGxpY2F0ZSBzdGFydCB2ZXJic1xuICAgIGNvbnN0IHJld3JpdGVSZXN1bHRzOiBCdWxsZXRSZXdyaXRlUmVzdWx0W10gPSBbXTtcbiAgICAvLyBUcmFjayB1c2VkIGxlYWRpbmcgdmVyYnMgdG8gYXZvaWQgcmVwZXRpdGlvblxuICAgIGNvbnN0IHVzZWRWZXJiczogc3RyaW5nW10gPSBbXTtcbiAgICAvLyBQcmVwYXJlIHRhc2tzIGZvciBlYWNoIGJ1bGxldFxuICAgIGNvbnN0IHRhc2tzOiB7IHdpOiBudW1iZXI7IGJpOiBudW1iZXI7IGJ1bGxldDogc3RyaW5nOyBhc3NpZ25lZEtleXdvcmRzOiBzdHJpbmdbXSB9W10gPSBbXTtcbiAgICB1cGRhdGVkLndvcmsuZm9yRWFjaCgod29ya0l0ZW0sIHdpKSA9PiB7XG4gICAgICB3b3JrSXRlbS5idWxsZXRzLmZvckVhY2goKGJ1bGxldCwgYmkpID0+IHtcbiAgICAgICAgY29uc3QgYXNzaWdubWVudCA9IGFzc2lnbm1lbnRzLmZpbmQoKGEpID0+IGEud29ya0luZGV4ID09PSB3aSAmJiBhLmJ1bGxldEluZGV4ID09PSBiaSk7XG4gICAgICAgIHRhc2tzLnB1c2goeyB3aSwgYmksIGJ1bGxldCwgYXNzaWduZWRLZXl3b3JkczogYXNzaWdubWVudD8uYXNzaWduZWRLZXl3b3JkcyB8fCBbXSB9KTtcbiAgICAgIH0pO1xuICAgIH0pO1xuICAgIGNvbnN0IGNvbmN1cnJlbmN5ID0gMztcbiAgICBmb3IgKGxldCBpID0gMDsgaSA8IHRhc2tzLmxlbmd0aDsgaSArPSBjb25jdXJyZW5jeSkge1xuICAgICAgY29uc3QgYmF0Y2ggPSB0YXNrcy5zbGljZShpLCBpICsgY29uY3VycmVuY3kpO1xuICAgICAgLy8gU2VuZCByZXdyaXRlIHJlcXVlc3RzLCBwYXNzaW5nIGFscmVhZHkgdXNlZCB2ZXJic1xuICAgICAgY29uc3QgcmVzdWx0cyA9IGF3YWl0IFByb21pc2UuYWxsKFxuICAgICAgICBiYXRjaC5tYXAoYXN5bmMgKHsgd2ksIGJpLCBidWxsZXQsIGFzc2lnbmVkS2V5d29yZHMgfSkgPT4ge1xuICAgICAgICAgIGNvbnN0IGJ1bGxldFJlcyA9IGF3YWl0IGZldGNoKGAke2Jhc2VVcmx9L2FwaS9yZXdyaXRlLWJ1bGxldGAsIHtcbiAgICAgICAgICAgIG1ldGhvZDogJ1BPU1QnLFxuICAgICAgICAgICAgaGVhZGVyczogeyAnQ29udGVudC1UeXBlJzogJ2FwcGxpY2F0aW9uL2pzb24nIH0sXG4gICAgICAgICAgICBib2R5OiBKU09OLnN0cmluZ2lmeSh7XG4gICAgICAgICAgICAgIGJ1bGxldCxcbiAgICAgICAgICAgICAga2V5d29yZHM6IGFzc2lnbmVkS2V5d29yZHMsXG4gICAgICAgICAgICAgIGpvYlRpdGxlOiB1cGRhdGVkLndvcmtbd2ldLnRpdGxlLFxuICAgICAgICAgICAgICBjb21wYW55OiB1cGRhdGVkLndvcmtbd2ldLmNvbXBhbnksXG4gICAgICAgICAgICAgIGpvYkRlc2NyaXB0aW9uLFxuICAgICAgICAgICAgICBza2lsbHM6IHVwZGF0ZWQuc2tpbGxzLFxuICAgICAgICAgICAgICB0YXJnZXRUaXRsZSxcbiAgICAgICAgICAgICAgdGFyZ2V0Q29tcGFueSxcbiAgICAgICAgICAgICAgcmVxdWlyZW1lbnRzLFxuICAgICAgICAgICAgICB1c2VkVmVyYnMsXG4gICAgICAgICAgICB9KSxcbiAgICAgICAgICB9KTtcbiAgICAgICAgICBpZiAoIWJ1bGxldFJlcy5vaykgdGhyb3cgbmV3IEVycm9yKCdyZXdyaXRlLWJ1bGxldCBmYWlsZWQnKTtcbiAgICAgICAgICBjb25zdCB7IHJld3JpdHRlbkJ1bGxldCwga2V5d29yZHNVc2VkIH0gPSAoYXdhaXQgYnVsbGV0UmVzLmpzb24oKSkgYXMgUmV3cml0ZUJ1bGxldFJlc3BvbnNlO1xuICAgICAgICAgIHJldHVybiB7IHdpLCBiaSwgcmV3cml0dGVuQnVsbGV0LCBrZXl3b3Jkc1VzZWQgfTtcbiAgICAgICAgfSlcbiAgICAgICk7XG4gICAgICAvLyBBcHBseSByZXN1bHRzIGFuZCBjYXB0dXJlIGxlYWRpbmcgdmVyYnNcbiAgICAgIHJlc3VsdHMuZm9yRWFjaCgoeyB3aSwgYmksIHJld3JpdHRlbkJ1bGxldCwga2V5d29yZHNVc2VkIH0pID0+IHtcbiAgICAgICAgdXBkYXRlZC53b3JrW3dpXS5idWxsZXRzW2JpXSA9IHJld3JpdHRlbkJ1bGxldDtcbiAgICAgICAgcmV3cml0ZVJlc3VsdHMucHVzaCh7IHdvcmtJbmRleDogd2ksIGJ1bGxldEluZGV4OiBiaSwgcmV3cml0dGVuQnVsbGV0LCBrZXl3b3Jkc1VzZWQgfSk7XG4gICAgICAgIC8vIEV4dHJhY3QgZmlyc3Qgd29yZCBhcyB2ZXJiIGFuZCB0cmFjayBpdFxuICAgICAgICBjb25zdCBmaXJzdFdvcmQgPSByZXdyaXR0ZW5CdWxsZXQudHJpbSgpLnNwbGl0KC9cXHMrLylbMF0ucmVwbGFjZSgvW15BLVphLXpdL2csICcnKTtcbiAgICAgICAgaWYgKGZpcnN0V29yZCkgdXNlZFZlcmJzLnB1c2goZmlyc3RXb3JkLnRvTG93ZXJDYXNlKCkpO1xuICAgICAgfSk7XG4gICAgfVxuXG4gICAgLy8gNS4gUmV3cml0ZSBzdW1tYXJ5XG4gICAgLy8gNS4gUmV3cml0ZSBzdW1tYXJ5IHZpYSBQYWdlcyBBUElcbiAgICAvLyBCdWlsZCBhbiBleHBlcmllbmNlIHNuYXBzaG90IGZvciBwcm9tcHQgY29udGV4dFxuICAgIGNvbnN0IGNvbXBhbmllcyA9IEFycmF5LmZyb20obmV3IFNldChwYXJzZWRSZXN1bWUud29yay5tYXAodyA9PiB3LmNvbXBhbnkpKSkuam9pbignLCAnKTtcbiAgICBjb25zdCB0aXRsZXMgPSBBcnJheS5mcm9tKG5ldyBTZXQocGFyc2VkUmVzdW1lLndvcmsubWFwKHcgPT4gdy50aXRsZSkpKS5qb2luKCcsICcpO1xuICAgIGNvbnN0IHBhcnNlWWVhciA9IChzOiBzdHJpbmcpID0+IHtcbiAgICAgIGNvbnN0IG0gPSBzLm1hdGNoKC9cXGR7NH0vKTtcbiAgICAgIHJldHVybiBtID8gcGFyc2VJbnQobVswXSwgMTApIDogbnVsbDtcbiAgICB9O1xuICAgIGNvbnN0IGVuZFllYXJzID0gcGFyc2VkUmVzdW1lLndvcmsubWFwKHcgPT4gcGFyc2VZZWFyKHcudG8gfHwgJycpIHx8IG5ldyBEYXRlKCkuZ2V0RnVsbFllYXIoKSkuZmlsdGVyKCh5KTogeSBpcyBudW1iZXIgPT4gISF5KTtcbiAgICBjb25zdCBzdGFydFllYXJzID0gcGFyc2VkUmVzdW1lLndvcmsubWFwKHcgPT4gcGFyc2VZZWFyKHcuZnJvbSB8fCAnJykgfHwgKGVuZFllYXJzWzBdIHx8IG5ldyBEYXRlKCkuZ2V0RnVsbFllYXIoKSkpLmZpbHRlcigoeSk6IHkgaXMgbnVtYmVyID0+ICEheSk7XG4gICAgY29uc3QgeWVhcnNFeHAgPSBlbmRZZWFycy5sZW5ndGggJiYgc3RhcnRZZWFycy5sZW5ndGggPyBNYXRoLm1heCguLi5lbmRZZWFycykgLSBNYXRoLm1pbiguLi5zdGFydFllYXJzKSA6IG51bGw7XG4gICAgY29uc3QgZXhwZXJpZW5jZVNuYXBzaG90ID0gW1xuICAgICAgeWVhcnNFeHAgPyBgJHt5ZWFyc0V4cH0rIHllYXJzIG9mIGV4cGVyaWVuY2VgIDogJycsXG4gICAgICBjb21wYW5pZXMgPyBgYWNyb3NzICR7Y29tcGFuaWVzfWAgOiAnJyxcbiAgICAgIHRpdGxlcyA/IGByb2xlcyBhcyAke3RpdGxlc31gIDogJydcbiAgICBdLmZpbHRlcihCb29sZWFuKS5qb2luKCcsICcpICsgJy4nO1xuICAgIGNvbnN0IHN1bW1hcnlSZXMgPSBhd2FpdCBmZXRjaChgJHtiYXNlVXJsfS9hcGkvcmV3cml0ZS1zdW1tYXJ5YCwge1xuICAgICAgbWV0aG9kOiAnUE9TVCcsXG4gICAgICBoZWFkZXJzOiB7ICdDb250ZW50LVR5cGUnOiAnYXBwbGljYXRpb24vanNvbicgfSxcbiAgICAgIGJvZHk6IEpTT04uc3RyaW5naWZ5KHtcbiAgICAgICAgb3JpZ2luYWxTdW1tYXJ5OiBwYXJzZWRSZXN1bWUuc3VtbWFyeSxcbiAgICAgICAgb3B0aW1pemVkQnVsbGV0czogdXBkYXRlZC53b3JrLmZsYXRNYXAoKHcpID0+IHcuYnVsbGV0cyksXG4gICAgICAgIHNraWxsczogdXBkYXRlZC5za2lsbHMsXG4gICAgICAgIHRhcmdldFRpdGxlLFxuICAgICAgICB0YXJnZXRDb21wYW55LFxuICAgICAgICByZXF1aXJlbWVudHMsXG4gICAgICAgIGtleXdvcmRzLFxuICAgICAgICBqb2JEZXNjcmlwdGlvbixcbiAgICAgICAgZXhwZXJpZW5jZVNuYXBzaG90LFxuICAgICAgfSksXG4gICAgfSk7XG4gICAgaWYgKCFzdW1tYXJ5UmVzLm9rKSB0aHJvdyBuZXcgRXJyb3IoJ3Jld3JpdGUtc3VtbWFyeSBmYWlsZWQnKTtcbiAgICBjb25zdCB7IHJld3JpdHRlblN1bW1hcnkgfSA9IChhd2FpdCBzdW1tYXJ5UmVzLmpzb24oKSkgYXMgUmV3cml0ZVN1bW1hcnlSZXNwb25zZTtcbiAgICB1cGRhdGVkLnN1bW1hcnkgPSByZXdyaXR0ZW5TdW1tYXJ5O1xuXG4gICAgLy8gNi4gUmV3cml0ZSBza2lsbHNcbiAgICAvLyA2LiBSZXdyaXRlIHNraWxscyB2aWEgUGFnZXMgQVBJXG4gICAgY29uc3Qgc2tpbGxzUmVzID0gYXdhaXQgZmV0Y2goYCR7YmFzZVVybH0vYXBpL3Jld3JpdGUtc2tpbGxzYCwge1xuICAgICAgbWV0aG9kOiAnUE9TVCcsXG4gICAgICBoZWFkZXJzOiB7ICdDb250ZW50LVR5cGUnOiAnYXBwbGljYXRpb24vanNvbicgfSxcbiAgICAgIGJvZHk6IEpTT04uc3RyaW5naWZ5KHtcbiAgICAgICAgb3JpZ2luYWxTa2lsbHM6IHVwZGF0ZWQuc2tpbGxzLFxuICAgICAgICBvcHRpbWl6ZWRTdW1tYXJ5OiB1cGRhdGVkLnN1bW1hcnksXG4gICAgICAgIG9wdGltaXplZEJ1bGxldHM6IHVwZGF0ZWQud29yay5mbGF0TWFwKCh3KSA9PiB3LmJ1bGxldHMpLFxuICAgICAgICBrZXl3b3JkcyxcbiAgICAgICAgdGFyZ2V0VGl0bGUsXG4gICAgICAgIHRhcmdldENvbXBhbnksXG4gICAgICAgIHJlcXVpcmVtZW50cyxcbiAgICAgICAgam9iRGVzY3JpcHRpb24sXG4gICAgICB9KSxcbiAgICB9KTtcbiAgICBpZiAoIXNraWxsc1Jlcy5vaykgdGhyb3cgbmV3IEVycm9yKCdyZXdyaXRlLXNraWxscyBmYWlsZWQnKTtcbiAgICBjb25zdCB7IHJld3JpdHRlblNraWxscyB9ID0gKGF3YWl0IHNraWxsc1Jlcy5qc29uKCkpIGFzIFJld3JpdGVTa2lsbHNSZXNwb25zZTtcbiAgICB1cGRhdGVkLnNraWxscyA9IHJld3JpdHRlblNraWxscztcblxuICAgIC8vIDcuIFJld3JpdGUgcHJvamVjdHMgdmlhIFBhZ2VzIEFQSSAoaWYgcHJlc2VudClcbiAgICBpZiAocGFyc2VkUmVzdW1lLnByb2plY3RzICYmIHBhcnNlZFJlc3VtZS5wcm9qZWN0cy5sZW5ndGggPiAwKSB7XG4gICAgICBjb25zdCBwcm9qUmVzID0gYXdhaXQgZmV0Y2goYCR7YmFzZVVybH0vYXBpL3Jld3JpdGUtcHJvamVjdHNgLCB7XG4gICAgICAgIG1ldGhvZDogJ1BPU1QnLFxuICAgICAgICBoZWFkZXJzOiB7ICdDb250ZW50LVR5cGUnOiAnYXBwbGljYXRpb24vanNvbicgfSxcbiAgICAgICAgYm9keTogSlNPTi5zdHJpbmdpZnkoe1xuICAgICAgICAgIHByb2plY3RzOiBwYXJzZWRSZXN1bWUucHJvamVjdHMsXG4gICAgICAgICAga2V5d29yZHMsXG4gICAgICAgICAgcmVxdWlyZW1lbnRzLFxuICAgICAgICAgIHRhcmdldFRpdGxlLFxuICAgICAgICAgIHRhcmdldENvbXBhbnksXG4gICAgICAgICAgam9iRGVzY3JpcHRpb24sXG4gICAgICAgICAgc2tpbGxzOiB1cGRhdGVkLnNraWxscyxcbiAgICAgICAgICBzdW1tYXJ5OiB1cGRhdGVkLnN1bW1hcnlcbiAgICAgICAgfSlcbiAgICAgIH0pO1xuICAgICAgaWYgKCFwcm9qUmVzLm9rKSB0aHJvdyBuZXcgRXJyb3IoJ3Jld3JpdGUtcHJvamVjdHMgZmFpbGVkJyk7XG4gICAgICBjb25zdCB7IHJld3JpdHRlblByb2plY3RzIH0gPSAoYXdhaXQgcHJvalJlcy5qc29uKCkpIGFzIHsgcmV3cml0dGVuUHJvamVjdHM6IGFueVtdIH07XG4gICAgICB1cGRhdGVkLnByb2plY3RzID0gcmV3cml0dGVuUHJvamVjdHM7XG4gICAgfVxuICAgIC8vIDguIFBlcnNpc3Qgb3B0aW1pemF0aW9uIHJ1blxuICAgIGNvbnN0IHJ1bkRhdGE6IE9wdGltaXphdGlvblJ1bkRhdGEgPSB7XG4gICAgICB1c2VySWQsXG4gICAgICByZXN1bWVGaWxlSWQ6IHJlc3VtZUZpbGUuaWQsXG4gICAgICBqb2JEZXNjcmlwdGlvbixcbiAgICAgIHRlbXBsYXRlSWQ6IFN0cmluZyh0ZW1wbGF0ZUlkKSxcbiAgICAgIG9yaWdpbmFsVGV4dDogSlNPTi5zdHJpbmdpZnkob3JpZ2luYWxQYXJzZWRSZXN1bWUpLFxuICAgICAgb3B0aW1pemVkVGV4dDogSlNPTi5zdHJpbmdpZnkodXBkYXRlZCksXG4gICAgICBidWxsZXRSZXdyaXRlczogcmV3cml0ZVJlc3VsdHMsXG4gICAgICBzdW1tYXJ5UmV3cml0ZTogdXBkYXRlZC5zdW1tYXJ5LFxuICAgICAgc2tpbGxzUmV3cml0ZTogSlNPTi5zdHJpbmdpZnkodXBkYXRlZC5za2lsbHMpLFxuICAgICAga2V5d29yZHMsXG4gICAgICByZXF1aXJlbWVudHMsXG4gICAgICB0YXJnZXRUaXRsZSxcbiAgICAgIHRhcmdldENvbXBhbnksXG4gICAgICBhaU1vZGVsOiAnbzMtbWluaS0yMDI1LTAxLTMxJyxcbiAgICAgIHRva2VuQ291bnQ6IDAsXG4gICAgICBjb3N0VXNkOiAwLFxuICAgIH07XG4gICAgY29uc3QgcnVuID0gYXdhaXQgcHJpc21hLm9wdGltaXphdGlvblJ1bi5jcmVhdGUoeyBkYXRhOiBydW5EYXRhIGFzIGFueSB9KTtcblxuICAgIC8vIFJldHVybiBmdWxsIHJlc3VsdFxuICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbih7XG4gICAgICBydW5JZDogcnVuLmlkLFxuICAgICAgb3JpZ2luYWxSZXN1bWU6IG9yaWdpbmFsUGFyc2VkUmVzdW1lLFxuICAgICAgb3B0aW1pemVkUmVzdW1lOiB1cGRhdGVkLFxuICAgICAga2V5d29yZHMsXG4gICAgICByZXF1aXJlbWVudHMsXG4gICAgICB0YXJnZXRUaXRsZSxcbiAgICAgIHRhcmdldENvbXBhbnksXG4gICAgfSk7XG4gIH0gY2F0Y2ggKGVycm9yOiBhbnkpIHtcbiAgICBjb25zb2xlLmVycm9yKCdFcnJvciBpbiBvcHRpbWl6ZS1yZXN1bWU6JywgZXJyb3IpO1xuICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbih7IGVycm9yOiBlcnJvci5tZXNzYWdlIHx8ICdJbnRlcm5hbCBlcnJvcicgfSwgeyBzdGF0dXM6IDUwMCB9KTtcbiAgfVxufSJdLCJuYW1lcyI6WyJOZXh0UmVzcG9uc2UiLCJhdXRoIiwiY2xlcmtDbGllbnQiLCJwcmlzbWEiLCJjcmVhdGVIYXNoIiwicnVudGltZSIsIlBPU1QiLCJyZXEiLCJyZXN1bWVUZXh0Iiwiam9iRGVzY3JpcHRpb24iLCJ0ZW1wbGF0ZUlkIiwiZmlsZU5hbWUiLCJqc29uIiwiZXJyb3IiLCJzdGF0dXMiLCJzZXNzaW9uIiwidXNlcklkIiwiY2xlcmtVc2VyIiwidXNlcnMiLCJnZXRVc2VyIiwiZW1haWwiLCJlbWFpbEFkZHJlc3NlcyIsImVtYWlsQWRkcmVzcyIsImZ1bGxOYW1lIiwiZmlyc3ROYW1lIiwibGFzdE5hbWUiLCJ0cmltIiwidXNlciIsInVwc2VydCIsIndoZXJlIiwiaWQiLCJjcmVhdGUiLCJ1cGRhdGUiLCJvcmlnaW5hbFRleHRIYXNoIiwiZGlnZXN0IiwicmVzdW1lRmlsZSIsImRhdGEiLCJmaWxlUGF0aCIsInByb3RvY29sIiwicHJvY2VzcyIsImhvc3QiLCJoZWFkZXJzIiwiZ2V0IiwiYmFzZVVybCIsImpkUmVzIiwiZmV0Y2giLCJtZXRob2QiLCJib2R5IiwiSlNPTiIsInN0cmluZ2lmeSIsIm9rIiwiRXJyb3IiLCJrZXl3b3JkcyIsInRhcmdldFRpdGxlIiwidGFyZ2V0Q29tcGFueSIsInJlcXVpcmVtZW50cyIsInBhcnNlUmVzIiwicmVzdW1lIiwicGFyc2VkUmVzdW1lIiwib3JpZ2luYWxQYXJzZWRSZXN1bWUiLCJwYXJzZSIsInVwZGF0ZWQiLCJtYXBSZXMiLCJyZXN1bWVEYXRhIiwiYXNzaWdubWVudHMiLCJyZXdyaXRlUmVzdWx0cyIsInVzZWRWZXJicyIsInRhc2tzIiwid29yayIsImZvckVhY2giLCJ3b3JrSXRlbSIsIndpIiwiYnVsbGV0cyIsImJ1bGxldCIsImJpIiwiYXNzaWdubWVudCIsImZpbmQiLCJhIiwid29ya0luZGV4IiwiYnVsbGV0SW5kZXgiLCJwdXNoIiwiYXNzaWduZWRLZXl3b3JkcyIsImNvbmN1cnJlbmN5IiwiaSIsImxlbmd0aCIsImJhdGNoIiwic2xpY2UiLCJyZXN1bHRzIiwiUHJvbWlzZSIsImFsbCIsIm1hcCIsImJ1bGxldFJlcyIsImpvYlRpdGxlIiwidGl0bGUiLCJjb21wYW55Iiwic2tpbGxzIiwicmV3cml0dGVuQnVsbGV0Iiwia2V5d29yZHNVc2VkIiwiZmlyc3RXb3JkIiwic3BsaXQiLCJyZXBsYWNlIiwidG9Mb3dlckNhc2UiLCJjb21wYW5pZXMiLCJBcnJheSIsImZyb20iLCJTZXQiLCJ3Iiwiam9pbiIsInRpdGxlcyIsInBhcnNlWWVhciIsInMiLCJtIiwibWF0Y2giLCJwYXJzZUludCIsImVuZFllYXJzIiwidG8iLCJEYXRlIiwiZ2V0RnVsbFllYXIiLCJmaWx0ZXIiLCJ5Iiwic3RhcnRZZWFycyIsInllYXJzRXhwIiwiTWF0aCIsIm1heCIsIm1pbiIsImV4cGVyaWVuY2VTbmFwc2hvdCIsIkJvb2xlYW4iLCJzdW1tYXJ5UmVzIiwib3JpZ2luYWxTdW1tYXJ5Iiwic3VtbWFyeSIsIm9wdGltaXplZEJ1bGxldHMiLCJmbGF0TWFwIiwicmV3cml0dGVuU3VtbWFyeSIsInNraWxsc1JlcyIsIm9yaWdpbmFsU2tpbGxzIiwib3B0aW1pemVkU3VtbWFyeSIsInJld3JpdHRlblNraWxscyIsInByb2plY3RzIiwicHJvalJlcyIsInJld3JpdHRlblByb2plY3RzIiwicnVuRGF0YSIsInJlc3VtZUZpbGVJZCIsIlN0cmluZyIsIm9yaWdpbmFsVGV4dCIsIm9wdGltaXplZFRleHQiLCJidWxsZXRSZXdyaXRlcyIsInN1bW1hcnlSZXdyaXRlIiwic2tpbGxzUmV3cml0ZSIsImFpTW9kZWwiLCJ0b2tlbkNvdW50IiwiY29zdFVzZCIsInJ1biIsIm9wdGltaXphdGlvblJ1biIsInJ1bklkIiwib3JpZ2luYWxSZXN1bWUiLCJvcHRpbWl6ZWRSZXN1bWUiLCJjb25zb2xlIiwibWVzc2FnZSJdLCJpZ25vcmVMaXN0IjpbXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(rsc)/./src/app/api/optimize-resume/route.ts\n");

/***/ }),

/***/ "(rsc)/./src/lib/prisma.ts":
/*!***************************!*\
  !*** ./src/lib/prisma.ts ***!
  \***************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   prisma: () => (/* binding */ prisma)\n/* harmony export */ });\n/* harmony import */ var _prisma_client__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @prisma/client */ \"@prisma/client\");\n/* harmony import */ var _prisma_client__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(_prisma_client__WEBPACK_IMPORTED_MODULE_0__);\n\nconst prisma = global.prisma || new _prisma_client__WEBPACK_IMPORTED_MODULE_0__.PrismaClient();\nif (true) {\n    global.prisma = prisma;\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9zcmMvbGliL3ByaXNtYS50cyIsIm1hcHBpbmdzIjoiOzs7Ozs7QUFBOEM7QUFNdkMsTUFBTUMsU0FBU0MsT0FBT0QsTUFBTSxJQUFJLElBQUlELHdEQUFZQSxHQUFHO0FBRTFELElBQUlHLElBQXFDLEVBQUU7SUFDekNELE9BQU9ELE1BQU0sR0FBR0E7QUFDbEIiLCJzb3VyY2VzIjpbIi9Vc2Vycy9jb2xpbmhheWVzL3JlemlhLWFpLXJlc3VtZS1jcmFmdC9zcmMvbGliL3ByaXNtYS50cyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBQcmlzbWFDbGllbnQgfSBmcm9tICdAcHJpc21hL2NsaWVudCc7XG5cbmRlY2xhcmUgZ2xvYmFsIHtcbiAgdmFyIHByaXNtYTogUHJpc21hQ2xpZW50IHwgdW5kZWZpbmVkO1xufVxuXG5leHBvcnQgY29uc3QgcHJpc21hID0gZ2xvYmFsLnByaXNtYSB8fCBuZXcgUHJpc21hQ2xpZW50KCk7XG5cbmlmIChwcm9jZXNzLmVudi5OT0RFX0VOViAhPT0gJ3Byb2R1Y3Rpb24nKSB7XG4gIGdsb2JhbC5wcmlzbWEgPSBwcmlzbWE7XG59XG4iXSwibmFtZXMiOlsiUHJpc21hQ2xpZW50IiwicHJpc21hIiwiZ2xvYmFsIiwicHJvY2VzcyJdLCJpZ25vcmVMaXN0IjpbXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(rsc)/./src/lib/prisma.ts\n");

/***/ }),

/***/ "(ssr)/./node_modules/next/dist/build/webpack/loaders/next-flight-client-entry-loader.js?server=true!":
/*!******************************************************************************************************!*\
  !*** ./node_modules/next/dist/build/webpack/loaders/next-flight-client-entry-loader.js?server=true! ***!
  \******************************************************************************************************/
/***/ (() => {



/***/ }),

/***/ "../../server/app-render/action-async-storage.external":
/*!*******************************************************************************!*\
  !*** external "next/dist/server/app-render/action-async-storage.external.js" ***!
  \*******************************************************************************/
/***/ ((module) => {

"use strict";
module.exports = require("next/dist/server/app-render/action-async-storage.external.js");

/***/ }),

/***/ "../app-render/after-task-async-storage.external":
/*!***********************************************************************************!*\
  !*** external "next/dist/server/app-render/after-task-async-storage.external.js" ***!
  \***********************************************************************************/
/***/ ((module) => {

"use strict";
module.exports = require("next/dist/server/app-render/after-task-async-storage.external.js");

/***/ }),

/***/ "../app-render/work-async-storage.external":
/*!*****************************************************************************!*\
  !*** external "next/dist/server/app-render/work-async-storage.external.js" ***!
  \*****************************************************************************/
/***/ ((module) => {

"use strict";
module.exports = require("next/dist/server/app-render/work-async-storage.external.js");

/***/ }),

/***/ "./work-unit-async-storage.external":
/*!**********************************************************************************!*\
  !*** external "next/dist/server/app-render/work-unit-async-storage.external.js" ***!
  \**********************************************************************************/
/***/ ((module) => {

"use strict";
module.exports = require("next/dist/server/app-render/work-unit-async-storage.external.js");

/***/ }),

/***/ "@prisma/client":
/*!*********************************!*\
  !*** external "@prisma/client" ***!
  \*********************************/
/***/ ((module) => {

"use strict";
module.exports = require("@prisma/client");

/***/ }),

/***/ "crypto":
/*!*************************!*\
  !*** external "crypto" ***!
  \*************************/
/***/ ((module) => {

"use strict";
module.exports = require("crypto");

/***/ }),

/***/ "next/dist/compiled/next-server/app-page.runtime.dev.js":
/*!*************************************************************************!*\
  !*** external "next/dist/compiled/next-server/app-page.runtime.dev.js" ***!
  \*************************************************************************/
/***/ ((module) => {

"use strict";
module.exports = require("next/dist/compiled/next-server/app-page.runtime.dev.js");

/***/ }),

/***/ "next/dist/compiled/next-server/app-route.runtime.dev.js":
/*!**************************************************************************!*\
  !*** external "next/dist/compiled/next-server/app-route.runtime.dev.js" ***!
  \**************************************************************************/
/***/ ((module) => {

"use strict";
module.exports = require("next/dist/compiled/next-server/app-route.runtime.dev.js");

/***/ }),

/***/ "node:async_hooks":
/*!***********************************!*\
  !*** external "node:async_hooks" ***!
  \***********************************/
/***/ ((module) => {

"use strict";
module.exports = require("node:async_hooks");

/***/ }),

/***/ "node:crypto":
/*!******************************!*\
  !*** external "node:crypto" ***!
  \******************************/
/***/ ((module) => {

"use strict";
module.exports = require("node:crypto");

/***/ }),

/***/ "node:fs":
/*!**************************!*\
  !*** external "node:fs" ***!
  \**************************/
/***/ ((module) => {

"use strict";
module.exports = require("node:fs");

/***/ }),

/***/ "node:path":
/*!****************************!*\
  !*** external "node:path" ***!
  \****************************/
/***/ ((module) => {

"use strict";
module.exports = require("node:path");

/***/ })

};
;

// load runtime
var __webpack_require__ = require("../../../webpack-runtime.js");
__webpack_require__.C(exports);
var __webpack_exec__ = (moduleId) => (__webpack_require__(__webpack_require__.s = moduleId))
var __webpack_exports__ = __webpack_require__.X(0, ["vendor-chunks/next","vendor-chunks/@clerk","vendor-chunks/@opentelemetry","vendor-chunks/tslib","vendor-chunks/snakecase-keys","vendor-chunks/snake-case","vendor-chunks/no-case","vendor-chunks/map-obj","vendor-chunks/lower-case","vendor-chunks/dot-case","vendor-chunks/cookie"], () => (__webpack_exec__("(rsc)/./node_modules/next/dist/build/webpack/loaders/next-app-loader/index.js?name=app%2Fapi%2Foptimize-resume%2Froute&page=%2Fapi%2Foptimize-resume%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Foptimize-resume%2Froute.ts&appDir=%2FUsers%2Fcolinhayes%2Frezia-ai-resume-craft%2Fsrc%2Fapp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=%2FUsers%2Fcolinhayes%2Frezia-ai-resume-craft&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D!")));
module.exports = __webpack_exports__;

})();